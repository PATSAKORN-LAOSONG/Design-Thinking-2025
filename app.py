import streamlit as st
import pandas as pd
import numpy as np

st.set_page_config(page_title="‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô", layout="centered")

st.title("ü©∫ ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï")
st.write("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV")

# ===============================
# ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV
# ===============================
@st.cache_data
def load_data():
    df = pd.read_csv("table_1.csv")

    # ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
    df.columns = df.columns.str.strip()

    return df

df = load_data()

# ===============================
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
# ===============================
if len(df.columns) < 3:
    st.error("‡πÑ‡∏ü‡∏•‡πå CSV ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå")
    st.stop()

category_col = df.columns[0]
sys_col = df.columns[1]
dia_col = df.columns[2]

# ===============================
# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡πà‡∏≤
# ===============================
def parse_range(value):
    if pd.isna(value):
        return (np.nan, np.nan)

    value = str(value).strip()

    try:
        if ">=" in value:
            num = int(value.replace(">=", "").strip())
            return (num, float("inf"))

        if "-" in value:
            low, high = value.split("-")
            return (int(low.strip()), int(high.strip()))

        if "<" in value:
            num = int(value.replace("<", "").strip())
            return (0, num - 1)

    except:
        return (np.nan, np.nan)

    return (np.nan, np.nan)

# ===============================
# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
# ===============================
df[["Sys_min", "Sys_max"]] = df[sys_col].apply(lambda x: pd.Series(parse_range(x)))
df[["Dia_min", "Dia_max"]] = df[dia_col].apply(lambda x: pd.Series(parse_range(x)))

# ===============================
# ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
# ===============================
sys = st.number_input("‡∏Ñ‡πà‡∏≤ SYSTOLIC (‡∏ï‡∏±‡∏ß‡∏ö‡∏ô)", 0, 300, 120)
dia = st.number_input("‡∏Ñ‡πà‡∏≤ DIASTOLIC (‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á)", 0, 200, 80)

# ===============================
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö
# ===============================
if st.button("üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô"):

    st.subheader("üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô")

    if sys >= 180 or dia >= 120:
        result = "Hypertensive Crisis"
        st.error("‚ö†Ô∏è ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏°‡∏≤‡∏Å ‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ")

    elif sys >= 140 or dia >= 90:
        result = "Hypertension Stage 2"
        st.error("‚ö†Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö 2 ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå")

    elif sys >= 130 or dia >= 80:
        result = "Hypertension Stage 1"
        st.warning("‡∏Ñ‡∏ß‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£")

    elif sys >= 120 and dia < 80:
        result = "Elevated"
        st.info("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°")

    else:
        result = "Normal"
        st.success("‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥")

    st.success(f"‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: **{result}**")
